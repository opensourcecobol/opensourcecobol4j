AT_SETUP([-free and -free_1col_aster])

AT_DATA([prog.cbl], [
IDENTIFICATION              DIVISION.
PROGRAM-ID.                 prog.
DATA                        DIVISION.
WORKING-STORAGE             SECTION.
PROCEDURE                   DIVISION.
    DISPLAY "HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO".
])

AT_CHECK([${COBJ} -free prog.cbl])
AT_CHECK([${RUN_MODULE} prog], [0],
[HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO
])

AT_DATA([prog2.cbl], [
*aaaa
IDENTIFICATION              DIVISION.
PROGRAM-ID.                 prog2.
DATA                        DIVISION.
WORKING-STORAGE             SECTION.
PROCEDURE                   DIVISION.
    DISPLAY "HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO".
    DISPLAY "HELLO
*world world".
WORLD".
])

AT_CHECK([${COBJ} -free_1col_aster prog2.cbl])
AT_CHECK([${RUN_MODULE} prog2], [0],
[HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO
HELLO

WORLD
])

AT_CLEANUP

AT_SETUP([-free_com_area_code])

AT_DATA([prog.cbl], [
1      IDENTIFICATION              DIVISION.
2      PROGRAM-ID.                 prog.
3      DATA                        DIVISION.
4      WORKING-STORAGE             SECTION.
5      PROCEDURE                   DIVISION.
6          DISPLAY "HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO".
])

AT_CHECK([${COBJ} -free_com_area_code prog.cbl])
AT_CHECK([${RUN_MODULE} prog], [0],
[HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO
])

AT_DATA([prog2.cbl], [
1      IDENTIFICATION              DIVISION.
2      PROGRAM-ID.                 prog2.
3      DATA                        DIVISION.
4      WORKING-STORAGE             SECTION.
5     PROCEDURE                   DIVISION.
6          STOP RUN.
])

AT_CHECK([${COBJ} -free_com_area_code prog2.cbl], [1], [],
[prog2.cbl:5: Error: Invalid indicator 'P' at column 7
])

AT_CLEANUP