AT_SETUP([-free and -free_1col_aster])

AT_DATA([prog.cbl], [
IDENTIFICATION              DIVISION.
PROGRAM-ID.                 prog.
DATA                        DIVISION.
WORKING-STORAGE             SECTION.
PROCEDURE                   DIVISION.
    DISPLAY "HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO".
])

AT_CHECK([${COBJ} -free prog.cbl])
AT_CHECK([${RUN_MODULE} prog], [0],
[HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO
])

AT_DATA([prog2.cbl], [
*aaaa
IDENTIFICATION              DIVISION.
PROGRAM-ID.                 prog2.
DATA                        DIVISION.
WORKING-STORAGE             SECTION.
PROCEDURE                   DIVISION.
    DISPLAY "HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO".
    DISPLAY "HELLO
*world world".
WORLD".
])

AT_CHECK([${COBJ} -free_1col_aster prog2.cbl])
AT_CHECK([${RUN_MODULE} prog2], [0],
[HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO
HELLO

WORLD
])

AT_CLEANUP

AT_SETUP([-free_com_area_code])

AT_DATA([prog.cbl], [
000001 IDENTIFICATION              DIVISION.
000002 PROGRAM-ID.                 prog.
000003 DATA                        DIVISION.
000004 WORKING-STORAGE             SECTION.
000005 PROCEDURE                   DIVISION.
000006     DISPLAY "HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO".
])

AT_CHECK([${COBJ} -free_com_area_code prog.cbl])
AT_CHECK([${RUN_MODULE} prog], [0],
[HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO
])

AT_DATA([prog2.cbl], [
000001 IDENTIFICATION              DIVISION.
000002 PROGRAM-ID.                 prog2.
000003 DATA                        DIVISION.
000004 WORKING-STORAGE             SECTION.
000005PROCEDURE                   DIVISION.
000006     STOP RUN.
])

AT_CHECK([${COBJ} -free_com_area_code prog2.cbl], [1], [],
[prog2.cbl:5: Error: Invalid indicator 'P' at column 7
])

AT_DATA([prog3.cbl], [
000001 IDENTIFICATION              DIVISION.
000002 PROGRAM-ID.                 prog3.
000003 DATA                        DIVISION.
000004 WORKING-STORAGE             SECTION.
000005 COPY                        inc.
000006 PROCEDURE                   DIVISION.
000007     DISPLAY AFTER-72.
000008     DISPLAY "HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO". 
000009     STOP RUN.
])

AT_DATA([inc.cpy], [
000001 01 AFTER-72 PIC X(119) VALUE "HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO".
])

AT_CHECK([${COBJ} -free_com_area_code prog3.cbl])
AT_CHECK([${RUN_MODULE} prog3], [0],
[HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO
HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO HELLO
])

AT_CLEANUP