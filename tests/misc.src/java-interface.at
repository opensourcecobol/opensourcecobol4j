AT_SETUP([no-argument])

AT_DATA([b.cbl], [
       identification division.
       program-id. b.
       data division.
       linkage section.
       procedure division.
         display "<cobol> b".
])

AT_DATA([a.java], [
import jp.osscons.opensourcecobol.libcobj.ui.*;
public class a {
	public static void main(String@<:@@:>@ args) {
		b prog = new b();
		CobolResultSet rs = prog.execute();
	}
}
])

AT_CHECK([cobj b.cbl])
AT_CHECK([javac a.java])
AT_CHECK([java a], [0],
[<cobol> b
])

AT_CLEANUP

AT_SETUP([PIC 9(3)])

AT_DATA([b.cbl], [
       identification division.
       program-id. b.
       data division.
       linkage section.
       01 arg pic 9(3).
       procedure division using arg.
         display "<cobol> arg: " arg.
         add 1 to arg.
])

AT_DATA([a.java], [
import jp.osscons.opensourcecobol.libcobj.ui.*;
public class a {
	public static void main(String@<:@@:>@ args) {
		b prog = new b();
		CobolResultSet rs;
		try{
			rs = prog.execute(0);
			System.out.println("<java> arg: " + rs.getInt(1));
			rs = prog.execute(1);
			System.out.println("<java> arg: " + rs.getInt(1));
			rs = prog.execute(998);
			System.out.println("<java> arg: " + rs.getInt(1));
		} catch(CobolResultSetException e) {
			e.printStackTrace();
		}
	}
}
])

AT_CHECK([cobj b.cbl])
AT_CHECK([javac a.java])
AT_CHECK([java a], [0],
[<cobol> arg: 000
<java> arg: 1
<cobol> arg: 001
<java> arg: 2
<cobol> arg: 998
<java> arg: 999
])

AT_CLEANUP

AT_SETUP([PIC S9(3)])

AT_DATA([b.cbl], [
       identification division.
       program-id. b.
       data division.
       linkage section.
       01 arg pic S9(3).
       procedure division using arg.
         display "<cobol> arg: " arg.
         add 1 to arg.
])

AT_DATA([a.java], [
import jp.osscons.opensourcecobol.libcobj.ui.*;
public class a {
	public static void main(String@<:@@:>@ args) {
		b prog = new b();
		CobolResultSet rs;
		int@<:@@:>@ data_list = {-999, -2, -1, 0, 1, 2, 998};
		try{
			for(int data : data_list) {
				rs = prog.execute(data);
				System.out.println("<java> arg: " + rs.getInt(1));
			}
		} catch(CobolResultSetException e) {
			e.printStackTrace();
		}
	}
}
])

AT_CHECK([cobj b.cbl])
AT_CHECK([javac a.java])
AT_CHECK([java a], [0],
[<cobol> arg: -999
<java> arg: -998
<cobol> arg: -002
<java> arg: -1
<cobol> arg: -001
<java> arg: 0
<cobol> arg: +000
<java> arg: 1
<cobol> arg: +001
<java> arg: 2
<cobol> arg: +002
<java> arg: 3
<cobol> arg: +998
<java> arg: 999
])

AT_CLEANUP
